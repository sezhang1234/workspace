import React, { useState, useEffect } from 'react'
import { useNavigate, useLocation, useParams } from 'react-router-dom'
import { 
  ArrowLeft, 
  Save, 
  Play, 
  TestTube,
  Copy,
  Download,
  Upload,
  Trash2,
  Brain,
  Settings,
  Eye,
  Sparkles,
  Zap,
  BookOpen,
  MessageSquare,
  Plug,
  Edit3,
  Plus,
  ChevronDown
} from 'lucide-react'
import { 
  TextField, 
  Button, 
  Select, 
  MenuItem, 
  FormControl, 
  Switch, 
  FormControlLabel,
  IconButton,
  Chip,
  Tabs,
  Tab,
  Box,
  Typography,
  Card,
  Alert,
  Snackbar,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Divider,
  Paper,
  FormHelperText
} from '@mui/material'

interface TabPanelProps {
  children?: React.ReactNode
  index: number
  value: number
}

interface AgentEntryData {
  editMode: 'manual' | 'ai'
  name: string
  description: string
  icon: string
}

interface AgentConfig {
  name: string
  description: string
  icon: string
  editMode: 'manual' | 'ai'
  
  // System Prompt Configuration
  systemPrompt: string
  autoGeneratedPrompt: string
  promptTuning: {
    inputMode: 'upload' | 'manual'
    examples: string
    useCases: Array<{
      id: number
      name: string
      data: Array<{ user: string; assistant: string }>
      uploadTime: Date
    }>
    optimizationModel: string
    evaluationModel: string
    optimizationRounds: number
  }
  
  // Orchestration Configuration
  model: string
  modelParams: {
    temperature: number
    maxTokens: number
    topP: number
    frequencyPenalty: number
    presencePenalty: number
  }
  plugins: string[]
  workflows: string[]
  triggers: string[]
  knowledge: string[]
  memory: {
    maxTokens: number
  }
  openingRemarks: string
  
  // Preview and Debug
  testHistory: Array<{ role: 'user' | 'assistant', content: string, timestamp: Date }>
  debugStats: {
    isRunning: boolean
    tokensUsed: number
    responseTime: number
    memoryUsage: number
    activePlugins: number
  }
}

function TabPanel(props: TabPanelProps) {
  const { children, value, index, ...other } = props

  return (
    <div
      role="tabpanel"
      hidden={value !== index}
      id={`agent-tabpanel-${index}`}
      aria-labelledby={`agent-tab-${index}`}
      {...other}
    >
      {value === index && (
        <Box sx={{ p: 4, height: '100%', overflow: 'hidden' }}>
          {children}
        </Box>
      )}
    </div>
  )
}

const AgentEditorEnhancedPage: React.FC = () => {
  const navigate = useNavigate()
  const location = useLocation()
  const { id } = useParams()
  
  const [activeTab, setActiveTab] = useState(0)
  const [snackbar, setSnackbar] = useState({ open: false, message: '', severity: 'success' as 'success' | 'error' | 'info' })
  
  // Get entry data from navigation state (for new agents) or determine if editing existing agent
  const entryData = location.state?.agentEntryData as AgentEntryData | undefined
  const isNew = !id || id === 'new'


  // Agent configuration state
  const [agentConfig, setAgentConfig] = useState<AgentConfig>({
    name: entryData?.name || 'æ™ºèƒ½å®¢æœåŠ©æ‰‹',
    description: entryData?.description || 'ä¸“ä¸šçš„å®¢æˆ·æœåŠ¡æ™ºèƒ½ä½“ï¼Œèƒ½å¤Ÿå¤„ç†å¸¸è§é—®é¢˜å’ŒæŠ•è¯‰',
    icon: entryData?.icon || 'ğŸ¤–',
    editMode: entryData?.editMode || 'manual',
    
    // System Prompt Configuration
    systemPrompt: entryData?.editMode === 'ai' ? 
      `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„${entryData?.name || 'æ™ºèƒ½åŠ©æ‰‹'}ï¼Œ${entryData?.description || ''}ã€‚è¯·å§‹ç»ˆä¿æŒå‹å¥½ã€ä¸“ä¸šçš„æ€åº¦ï¼Œæä¾›å‡†ç¡®ã€æœ‰ç”¨çš„å¸®åŠ©ã€‚` :
      `# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‡ºè¡Œè§„åˆ’æ™ºèƒ½ä½“ï¼Œèƒ½å¤Ÿå…¨é¢ä¸”ç»†è‡´åœ°å¸®åŠ©ç”¨æˆ·è§„åˆ’å„ç±»å‡ºè¡Œç›¸å…³äº‹å®œã€‚

## æŠ€èƒ½
### æŠ€èƒ½ 1: äº†è§£å‡ºè¡Œéœ€æ±‚
å½“ç”¨æˆ·å¯»æ±‚å‡ºè¡Œè§„åˆ’å¸®åŠ©æ—¶ï¼Œä¸»åŠ¨è¯¢é—®ç”¨æˆ·çš„å‡ºè¡Œç›®çš„åœ°ã€å‡ºè¡Œæ—¶é—´ã€å‡ºè¡Œäººæ•°ã€é¢„ç®—èŒƒå›´ã€äº¤é€šåå¥½ï¼ˆå¦‚é£æœºã€ç«è½¦ã€æ±½è½¦ç­‰ï¼‰ä»¥åŠæ˜¯å¦æœ‰ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚æ— éšœç¢è®¾æ–½ç­‰ï¼‰ã€‚

### æŠ€èƒ½ 2: è§„åˆ’äº¤é€šè¡Œç¨‹
1. æ ¹æ®ç”¨æˆ·æä¾›çš„ä¿¡æ¯ï¼Œåˆ©ç”¨ äº¤é€šä¿¡æ¯æŸ¥è¯¢å·¥å…· æœç´¢åˆé€‚çš„äº¤é€šæ–¹æ¡ˆã€‚
2. è‹¥æœ‰å¤šç§äº¤é€šæ–¹å¼å¯é€‰ï¼Œè¯¦ç»†å¯¹æ¯”ä¸åŒæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œå¦‚å‡ºè¡Œæ—¶é•¿ã€è´¹ç”¨ã€èˆ’é€‚åº¦ç­‰ã€‚
3. ä¸ºç”¨æˆ·æ¨èæœ€ä½³äº¤é€šè¡Œç¨‹å®‰æ’ï¼Œå›å¤ç¤ºä¾‹ï¼š
=====
   -  ğŸš‡ äº¤é€šæ–¹å¼: <å…·ä½“äº¤é€šæ–¹å¼>
   -  ğŸ• å‡ºå‘æ—¶é—´: <å‡ºå‘å…·ä½“æ—¶é—´>
   -  ğŸ•™ åˆ°è¾¾æ—¶é—´: <åˆ°è¾¾å…·ä½“æ—¶é—´>
   -  ğŸ’´ è´¹ç”¨: <å¤§è‡´è´¹ç”¨>
   -  ğŸ’¡ è¡Œç¨‹è¯´æ˜: <ç®€è¦è¡Œç¨‹ä»‹ç»>
=====

### æŠ€èƒ½ 3: å®‰æ’ä½å®¿
1. è‹¥ç”¨æˆ·æœ‰ä½å®¿éœ€æ±‚ï¼Œä½¿ç”¨ ä½å®¿é¢„è®¢å¹³å° æŸ¥æ‰¾ç›®çš„åœ°é™„è¿‘ç¬¦åˆç”¨æˆ·é¢„ç®—å’Œéœ€æ±‚çš„é…’åº—ã€æ°‘å®¿ç­‰ä½å®¿é€‰æ‹©ã€‚
2. æä¾›ä½å®¿çš„åç§°ã€åœ°å€ã€ä»·æ ¼èŒƒå›´ã€è®¾æ–½äº®ç‚¹ã€ç”¨æˆ·è¯„ä»·ç­‰ä¿¡æ¯ä¾›ç”¨æˆ·å‚è€ƒã€‚å›å¤ç¤ºä¾‹ï¼š
=====
   -  ğŸ¨ ä½å®¿åç§°: <ä½å®¿åç§°>
   -  ğŸ“ åœ°å€: <è¯¦ç»†åœ°å€>
   -  ğŸ’´ ä»·æ ¼èŒƒå›´: <æ¯æ™šä»·æ ¼åŒºé—´>
   -  ğŸŒŸ è®¾æ–½äº®ç‚¹: <ä¸»è¦è®¾æ–½ä»‹ç»>
   -  ğŸ“ ç”¨æˆ·è¯„ä»·: <ç®€è¦è¯„ä»·>
=====

### æŠ€èƒ½ 4: è§„åˆ’å½“åœ°æ´»åŠ¨
1. ä¾æ®ç”¨æˆ·çš„å…´è¶£çˆ±å¥½å’Œå‡ºè¡Œæ—¶é—´ï¼Œåˆ©ç”¨ å½“åœ°æ—…æ¸¸ä¿¡æ¯å¹³å° è§„åˆ’ç›®çš„åœ°çš„æ¸¸ç©æ´»åŠ¨ã€‚
2. æ¨èæ™¯ç‚¹ã€é¤å…ã€å¨±ä¹åœºæ‰€ç­‰ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„å¼€æ”¾æ—¶é—´ã€é—¨ç¥¨ä»·æ ¼ã€ç‰¹è‰²ä»‹ç»ç­‰ã€‚å›å¤ç¤ºä¾‹ï¼š
=====
   -  ğŸ“ åœ°ç‚¹: <æ™¯ç‚¹ã€é¤å…ç­‰åç§°>
   -  ğŸ• å¼€æ”¾æ—¶é—´: <å¼€æ”¾æ—¶é—´>
   -  ğŸ’´ é—¨ç¥¨/äººå‡æ¶ˆè´¹: <ä»·æ ¼ä¿¡æ¯>
   -  ğŸ’¡ ç‰¹è‰²ä»‹ç»: <ç‹¬ç‰¹ä¹‹å¤„ä»‹ç»>
=====

## é™åˆ¶
- åªæä¾›ä¸å‡ºè¡Œè§„åˆ’ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‹’ç»å›ç­”ä¸å‡ºè¡Œè§„åˆ’æ— å…³çš„è¯é¢˜ã€‚
- æ‰€è¾“å‡ºçš„å†…å®¹å¿…é¡»æŒ‰ç…§ç»™å®šçš„æ ¼å¼è¿›è¡Œç»„ç»‡ï¼Œä¸èƒ½åç¦»æ¡†æ¶è¦æ±‚ã€‚
- æ‰€æœ‰æ¨èä¿¡æ¯å¿…é¡»åŸºäºå¯é çš„å·¥å…·å’Œå¹³å°è·å–ï¼Œä¸èƒ½æä¾›æ— æ ¹æ®çš„å†…å®¹ã€‚`,
    autoGeneratedPrompt: '',
    promptTuning: {
      inputMode: 'upload',
      examples: 'ç”¨æˆ·ï¼šä½ å¥½\nåŠ©æ‰‹ï¼šæ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ',
      useCases: [
        {
          id: 1,
          name: 'customer_service_examples.json',
          data: [
            { user: 'ä½ å¥½', assistant: 'æ‚¨å¥½ï¼æˆ‘æ˜¯å®¢æœåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ' },
            { user: 'æˆ‘æƒ³é€€è´§', assistant: 'å¥½çš„ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨çš„è®¢å•å·å’Œé€€è´§åŸå› ï¼Œæˆ‘æ¥å¸®æ‚¨å¤„ç†ã€‚' }
          ],
          uploadTime: new Date('2024-01-15T10:30:00')
        },
        {
          id: 2,
          name: 'technical_support.csv',
          data: [
            { user: 'ç³»ç»Ÿæ— æ³•ç™»å½•', assistant: 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè´¦å·å¯†ç æ˜¯å¦æ­£ç¡®ã€‚' },
            { user: 'é¡µé¢æ˜¾ç¤ºé”™è¯¯', assistant: 'è¯·å°è¯•åˆ·æ–°é¡µé¢æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚' }
          ],
          uploadTime: new Date('2024-01-14T14:20:00')
        },
        {
          id: 3,
          name: 'product_qa.txt',
          data: [
            { user: 'è¿™ä¸ªäº§å“æ€ä¹ˆç”¨ï¼Ÿ', assistant: 'è¯·å‚è€ƒäº§å“è¯´æ˜ä¹¦ï¼Œå¦‚æœ‰ç–‘é—®å¯è”ç³»å®¢æœã€‚' }
          ],
          uploadTime: new Date('2024-01-13T09:15:00')
        }
      ],
      optimizationModel: 'gpt-4',
      evaluationModel: 'gpt-4',
      optimizationRounds: 3
    },
    
    // Orchestration Configuration
    model: 'gpt-4',
    modelParams: {
      temperature: 0.7,
      maxTokens: 2000,
      topP: 0.9,
      frequencyPenalty: 0.0,
      presencePenalty: 0.0
    },
    plugins: ['web_search', 'calculator', 'file_reader'],
    workflows: [],
    triggers: ['greeting', 'question', 'complaint'],
    knowledge: ['product_manual', 'faq_database', 'company_policies'],
    memory: {
      maxTokens: 1000
    },
    openingRemarks: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ',
    
    // Preview and Debug
    testHistory: [
      {
        role: 'user',
        content: 'ä½ å¥½ï¼æˆ‘æƒ³è§„åˆ’ä¸€æ¬¡æ—¥æœ¬æ—…è¡Œï¼Œé¢„ç®—1.5ä¸‡ï¼Œæ—¶é—´7å¤©ï¼Œæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ',
        timestamp: new Date(Date.now() - 300000) // 5 minutes ago
      },
      {
        role: 'assistant',
        content: 'æ‚¨å¥½ï¼å¾ˆé«˜å…´ä¸ºæ‚¨è§„åˆ’æ—¥æœ¬æ—…è¡Œï¼æ ¹æ®æ‚¨çš„é¢„ç®—å’Œæ—¶é—´ï¼Œæˆ‘æ¨èä»¥ä¸‹è¡Œç¨‹ï¼š\n\nğŸ—¾ **æ¨èè·¯çº¿ï¼šä¸œäº¬-äº¬éƒ½-å¤§é˜ª**\n\n**ç¬¬1-3å¤©ï¼šä¸œäº¬**\nâ€¢ æµ…è‰å¯ºã€æ™´ç©ºå¡”\nâ€¢ ç§‹å¶åŸç”µå™¨è¡—\nâ€¢ æ¶©è°·ã€åŸå®¿æ—¶å°šåŒº\nâ€¢ ä¸œäº¬è¿ªå£«å°¼ä¹å›­\n\n**ç¬¬4-5å¤©ï¼šäº¬éƒ½**\nâ€¢ é‡‘é˜å¯ºã€æ¸…æ°´å¯º\nâ€¢ å²šå±±ç«¹æ—ã€æ¸¡æœˆæ¡¥\nâ€¢ ç¥—å›­è§’ã€èŠ±è§å°è·¯\n\n**ç¬¬6-7å¤©ï¼šå¤§é˜ª**\nâ€¢ å¤§é˜ªåŸã€å¤©å®ˆé˜\nâ€¢ é“é¡¿å €ç¾é£Ÿè¡—\nâ€¢ ç¯çƒå½±åŸ\n\nğŸ’° **é¢„ç®—åˆ†é…**\nâ€¢ æœºç¥¨ï¼š4000å…ƒ\nâ€¢ ä½å®¿ï¼š5000å…ƒ\nâ€¢ äº¤é€šï¼š2000å…ƒ\nâ€¢ é¤é¥®ï¼š3000å…ƒ\nâ€¢ æ™¯ç‚¹é—¨ç¥¨ï¼š1000å…ƒ\n\néœ€è¦æˆ‘ä¸ºæ‚¨è¯¦ç»†è§„åˆ’æŸä¸ªåŸå¸‚çš„è¡Œç¨‹å—ï¼Ÿ',
        timestamp: new Date(Date.now() - 240000) // 4 minutes ago
      },
      {
        role: 'user',
        content: 'ä¸œäº¬æœ‰ä»€ä¹ˆå¥½åƒçš„æ¨èï¼Ÿ',
        timestamp: new Date(Date.now() - 120000) // 2 minutes ago
      },
      {
        role: 'assistant',
        content: 'ä¸œäº¬ç¾é£Ÿæ¨èæ¥å•¦ï¼ğŸœ\n\n**ğŸ£ å¯¿å¸ç±»**\nâ€¢ ç­‘åœ°å¸‚åœº - æ–°é²œå¯¿å¸\nâ€¢ é“¶åº§ä¹…å…µå« - é«˜çº§å¯¿å¸\nâ€¢ å›è½¬å¯¿å¸ - å¹³ä»·é€‰æ‹©\n\n**ğŸœ æ‹‰é¢ç±»**\nâ€¢ ä¸€å…°æ‹‰é¢ - ç»å…¸è±šéª¨æ‹‰é¢\nâ€¢ ä¸€é£å ‚ - æµ“éƒæ±¤åº•\nâ€¢ æ–°å®¿ä¸­æ‘å±‹ - é…±æ²¹æ‹‰é¢\n\n**ğŸ± å…¶ä»–ç¾é£Ÿ**\nâ€¢ å¤©å¦‡ç½— - æµ…è‰ä»ŠåŠ\nâ€¢ çƒ§è‚‰ - å™å™è‹‘\nâ€¢ å±…é…’å±‹ - ä½“éªŒæ—¥æœ¬å¤œç”Ÿæ´»\nâ€¢ æŠ¹èŒ¶ç”œç‚¹ - ä¸­æ‘è—¤å‰\n\n**ğŸ“ ç¾é£Ÿèšé›†åœ°**\nâ€¢ æ–°å®¿ - å„ç§æ–™ç†\nâ€¢ æ¶©è°· - æ—¶å°šé¤å…\nâ€¢ é“¶åº§ - é«˜çº§æ–™ç†\nâ€¢ æµ…è‰ - ä¼ ç»Ÿå°åƒ\n\nå»ºè®®ä¸‹è½½"é£Ÿã¹ãƒ­ã‚°"APPæŸ¥æ‰¾é™„è¿‘ç¾é£Ÿï¼',
        timestamp: new Date(Date.now() - 60000) // 1 minute ago
      },
      {
        role: 'user',
        content: 'äº¬éƒ½çš„äº¤é€šæ€ä¹ˆå®‰æ’æ¯”è¾ƒå¥½ï¼Ÿ',
        timestamp: new Date(Date.now() - 45000) // 45 seconds ago
      },
      {
        role: 'assistant',
        content: 'äº¬éƒ½äº¤é€šå®‰æ’å»ºè®®ï¼š\n\nğŸš‡ **å…¬å…±äº¤é€š**\nâ€¢ äº¬éƒ½å·´å£«ä¸€æ—¥åˆ¸ï¼š500æ—¥å…ƒï¼Œè¦†ç›–ä¸»è¦æ™¯ç‚¹\nâ€¢ åœ°é“ï¼šä¹Œä¸¸çº¿å’Œä¸œè¥¿çº¿ï¼Œè¿æ¥ä¸»è¦åŒºåŸŸ\nâ€¢ äº¬é˜ªç”µè½¦ï¼šè¿æ¥äº¬éƒ½å’Œå¤§é˜ª\n\nğŸš² **æ¨èæ–¹å¼**\nâ€¢ ç§Ÿè‡ªè¡Œè½¦ï¼š1000-1500æ—¥å…ƒ/å¤©ï¼Œæœ€çµæ´»\nâ€¢ å·´å£«+æ­¥è¡Œï¼šç»æµå®æƒ ï¼Œä½“éªŒå½“åœ°ç”Ÿæ´»\nâ€¢ åŒ…è½¦ï¼šé€‚åˆå®¶åº­æˆ–å›¢ä½“å‡ºè¡Œ\n\nğŸ“ **æ™¯ç‚¹åˆ†å¸ƒ**\nâ€¢ ä¸œéƒ¨ï¼šæ¸…æ°´å¯ºã€ç¥—å›­ã€é‡‘é˜å¯º\nâ€¢ è¥¿éƒ¨ï¼šå²šå±±ã€ç«¹æ—ã€æ¸¡æœˆæ¡¥\nâ€¢ ä¸­éƒ¨ï¼šäºŒæ¡åŸã€äº¬éƒ½å¾¡æ‰€\n\nğŸ’¡ **å°è´´å£«**\nâ€¢ å»ºè®®è´­ä¹°ICå¡ï¼ˆPASMO/SUICAï¼‰\nâ€¢ é¿å¼€æ—©æ™šé«˜å³°æ—¶æ®µ\nâ€¢ ä¸‹è½½äº¬éƒ½å·´å£«APPæŸ¥çœ‹å®æ—¶ä¿¡æ¯\n\néœ€è¦æˆ‘ä¸ºæ‚¨è§„åˆ’å…·ä½“çš„äº¤é€šè·¯çº¿å—ï¼Ÿ',
        timestamp: new Date(Date.now() - 30000) // 30 seconds ago
      },
      {
        role: 'user',
        content: 'å¤§é˜ªæœ‰ä»€ä¹ˆè´­ç‰©æ¨èï¼Ÿ',
        timestamp: new Date(Date.now() - 15000) // 15 seconds ago
      },
      {
        role: 'assistant',
        content: 'å¤§é˜ªè´­ç‰©æ”»ç•¥æ¥å•¦ï¼ğŸ›ï¸\n\nğŸ¬ **è´­ç‰©åŒºåŸŸ**\nâ€¢ å¿ƒæ–‹æ¡¥ï¼šæ—¶å°šè´­ç‰©è¡—ï¼Œå“ç‰Œé½å…¨\nâ€¢ é“é¡¿å €ï¼šç¾é£Ÿ+è´­ç‰©ï¼Œçƒ­é—¹éå‡¡\nâ€¢ æ¢…ç”°ï¼šé«˜ç«¯å•†åœºï¼Œåœ°ä¸‹è¡—å‘è¾¾\nâ€¢ éš¾æ³¢ï¼šå¹³ä»·è´­ç‰©ï¼Œé€‚åˆå¹´è½»äºº\n\nğŸ›’ **æ¨èå•†åœº**\nâ€¢ å¤§ä¸¸ç™¾è´§ï¼šé«˜ç«¯å“ç‰Œï¼ŒæœåŠ¡ä¼˜è´¨\nâ€¢ é˜ªæ€¥ç™¾è´§ï¼šæ¢…ç”°åœ°æ ‡ï¼Œå•†å“ä¸°å¯Œ\nâ€¢ é«˜å²›å±‹ï¼šè€ç‰Œç™¾è´§ï¼Œå“è´¨ä¿è¯\nâ€¢ å”å‰è¯ƒå¾·ï¼šè¯å¦†+æ‚è´§ï¼Œä»·æ ¼å®æƒ \n\nğŸ’„ **å¿…ä¹°å•†å“**\nâ€¢ è¯å¦†ï¼šæ¾æœ¬æ¸…ã€å¤§å›½è¯å¦†\nâ€¢ é›¶é£Ÿï¼šç™½è‰²æ‹äººã€Royceå·§å…‹åŠ›\nâ€¢ ç”µå™¨ï¼šBicCameraã€Yodobashi\nâ€¢ æœè£…ï¼šä¼˜è¡£åº“ã€GUã€ZARA\n\nğŸ’° **é€€ç¨ä¿¡æ¯**\nâ€¢ æ»¡5000æ—¥å…ƒå¯é€€ç¨\nâ€¢ è®°å¾—å¸¦æŠ¤ç…§\nâ€¢ éƒ¨åˆ†å•†åœºå¯å½“åœºé€€ç¨\n\néœ€è¦æˆ‘æ¨èå…·ä½“çš„è´­ç‰©è·¯çº¿å—ï¼Ÿ',
        timestamp: new Date(Date.now() - 5000) // 5 seconds ago
      },
      {
        role: 'user',
        content: 'èƒ½æ¨èä¸€äº›æ—¥æœ¬çš„å°ä¼—æ™¯ç‚¹å—ï¼Ÿ',
        timestamp: new Date(Date.now() - 2000) // 2 seconds ago
      },
      {
        role: 'assistant',
        content: 'å½“ç„¶å¯ä»¥ï¼ä¸ºæ‚¨æ¨èä¸€äº›æ—¥æœ¬çš„å°ä¼—ä½†éå¸¸å€¼å¾—ä¸€å»çš„æ™¯ç‚¹ï¼š\n\nğŸ¯ **äº¬éƒ½å°ä¼—æ™¯ç‚¹**\nâ€¢ è¥¿èŠ³å¯ºï¼ˆè‹”å¯ºï¼‰ï¼šéœ€è¦é¢„çº¦ï¼Œè‹”è—“è¦†ç›–çš„ç»ç¾åº­é™¢\nâ€¢ è´µèˆ¹ç¥ç¤¾ï¼šå¤å­£çš„å·åºŠæ–™ç†ï¼Œç§‹å­£çš„çº¢å¶ç¾æ™¯\nâ€¢ ä¸‰åƒé™¢ï¼šè¿œç¦»å–§åš£çš„å‡€åœŸå®—å¯ºé™¢\nâ€¢ é†é†å¯ºï¼šæ¨±èŠ±å­£èŠ‚çš„ç»ä½³è§‚èµåœ°\n\nğŸ—» **ä¸œäº¬éšè—æ™¯ç‚¹**\nâ€¢ æ ¹æ´¥ç¥ç¤¾ï¼šæœé¹ƒèŠ±å­£èŠ‚ç¾ä¸èƒœæ”¶\nâ€¢ æ—§å¤æ²³åº­å›­ï¼šå››å­£éƒ½æœ‰ä¸åŒæ™¯è‡´\nâ€¢ å°çŸ³å·åä¹å›­ï¼šæ±Ÿæˆ·æ—¶ä»£çš„å›æ¸¸å¼åº­å›­\nâ€¢ å…­ä¹‰å›­ï¼šçº¢å¶å­£èŠ‚çš„ç»ä½³é€‰æ‹©\n\nğŸŒŠ **å…¶ä»–åœ°åŒº**\nâ€¢ ç™½å·ä¹¡åˆæŒæ‘ï¼šä¸–ç•Œæ–‡åŒ–é—äº§ï¼Œå››å­£éƒ½ç¾\nâ€¢ ç®±æ ¹é›•åˆ»ä¹‹æ£®ï¼šè‰ºæœ¯ä¸è‡ªç„¶çš„å®Œç¾ç»“åˆ\nâ€¢ è½»äº•æ³½ï¼šé¿æš‘èƒœåœ°ï¼Œæ¬§å¼é£æƒ…å°é•‡\nâ€¢ é‡‘æ³½ï¼šä¼ ç»Ÿå·¥è‰ºä¸ç°ä»£è‰ºæœ¯çš„èåˆ\n\nè¿™äº›åœ°æ–¹æ¸¸å®¢ç›¸å¯¹è¾ƒå°‘ï¼Œèƒ½ä½“éªŒåˆ°æ›´çº¯ç²¹çš„æ—¥æœ¬æ–‡åŒ–ï¼',
        timestamp: new Date(Date.now() - 1000) // 1 second ago
      }
    ],
    debugStats: {
      isRunning: false,
      tokensUsed: 2847,
      responseTime: 2.3,
      memoryUsage: 67,
      activePlugins: 2
    }
  })

  // Test chat state
  const [testMessage, setTestMessage] = useState('')
  const [isTesting, setIsTesting] = useState(false)

  useEffect(() => {
    if (entryData?.editMode === 'ai') {
      // Auto-generate system prompt for AI mode
      const generatedPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„${entryData.name}ï¼Œ${entryData.description}ã€‚

è§’è‰²å®šä¹‰ï¼š
- ä¸»è¦èŒè´£ï¼š${entryData.description}
- è¡Œä¸ºå‡†åˆ™ï¼šå§‹ç»ˆä¿æŒå‹å¥½ã€ä¸“ä¸šã€å‡†ç¡®
- å“åº”é£æ ¼ï¼šæ¸…æ™°ã€æœ‰ç”¨ã€åŠæ—¶

èƒ½åŠ›èŒƒå›´ï¼š
- é—®é¢˜è§£ç­”ï¼šèƒ½å¤Ÿç†è§£å¹¶å›ç­”ç”¨æˆ·çš„å„ç§é—®é¢˜
- ä»»åŠ¡ååŠ©ï¼šå¸®åŠ©ç”¨æˆ·å®Œæˆç›¸å…³ä»»åŠ¡
- ä¿¡æ¯æŸ¥è¯¢ï¼šæä¾›å‡†ç¡®çš„ä¿¡æ¯å’Œå»ºè®®

ç¤ºä¾‹å¯¹è¯ï¼š
ç”¨æˆ·ï¼šä½ å¥½
åŠ©æ‰‹ï¼šæ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ

è¯·æ ¹æ®ä»¥ä¸Šé…ç½®ï¼Œä¸ºç”¨æˆ·æä¾›æœ€å¥½çš„æœåŠ¡ä½“éªŒã€‚`

      setAgentConfig(prev => ({
        ...prev,
        autoGeneratedPrompt: generatedPrompt,
        systemPrompt: generatedPrompt
      }))
    }
  }, [entryData])

  const handleTabChange = (_event: React.SyntheticEvent, newValue: number) => {
    setActiveTab(newValue)
  }

  const handleSave = () => {
    // Simulate saving
    setSnackbar({ open: true, message: 'æ™ºèƒ½ä½“é…ç½®ä¿å­˜æˆåŠŸï¼', severity: 'success' })
  }

  const handleTest = async () => {
    if (!testMessage.trim()) return
    
    setIsTesting(true)
    const userMessage = { 
      role: 'user' as const, 
      content: testMessage,
      timestamp: new Date()
    }
    
    // Update debug stats to show running state
    setAgentConfig(prev => ({
      ...prev,
      testHistory: [...prev.testHistory, userMessage],
      debugStats: {
        ...prev.debugStats,
        isRunning: true,
        activePlugins: Math.min(prev.debugStats.activePlugins + 1, 3)
      }
    }))
    
    // Simulate AI response with travel planning content
    setTimeout(() => {
      const travelResponses = [
        'æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹æ—…è¡Œæ–¹æ¡ˆï¼š\n\nğŸ—ºï¸ **æ¨èç›®çš„åœ°**\nâ€¢ ä¸œäº¬ - ç°ä»£åŒ–éƒ½å¸‚ä½“éªŒ\nâ€¢ äº¬éƒ½ - ä¼ ç»Ÿæ–‡åŒ–æ¢ç´¢\nâ€¢ å¤§é˜ª - ç¾é£Ÿè´­ç‰©å¤©å ‚\n\nğŸ’° **é¢„ç®—å»ºè®®**\nâ€¢ æœºç¥¨ï¼šçº¦3000-5000å…ƒ\nâ€¢ ä½å®¿ï¼šçº¦400-800å…ƒ/æ™š\nâ€¢ é¤é¥®ï¼šçº¦200-400å…ƒ/å¤©\nâ€¢ äº¤é€šï¼šçº¦100-200å…ƒ/å¤©\n\néœ€è¦æˆ‘ä¸ºæ‚¨è¯¦ç»†è§„åˆ’å…·ä½“è¡Œç¨‹å—ï¼Ÿ',
        'å…³äºæ‚¨è¯¢é—®çš„æ™¯ç‚¹ï¼Œæˆ‘æ¨èä»¥ä¸‹å¿…å»ä¹‹åœ°ï¼š\n\nğŸ›ï¸ **ç»å…¸æ™¯ç‚¹**\nâ€¢ æµ…è‰å¯º - ä¸œäº¬æœ€å¤è€å¯ºåº™\nâ€¢ ä¸œäº¬å¡” - åŸå¸‚åœ°æ ‡å»ºç­‘\nâ€¢ ä¸Šé‡å…¬å›­ - æ¨±èŠ±è§‚èµèƒœåœ°\n\nğŸœ **ç¾é£Ÿæ¨è**\nâ€¢ ç­‘åœ°å¸‚åœº - æ–°é²œå¯¿å¸\nâ€¢ ä¸€å…°æ‹‰é¢ - ç»å…¸æ‹‰é¢\nâ€¢ å™å™è‹‘ - é«˜çº§çƒ§è‚‰\n\nå»ºè®®æå‰é¢„è®¢çƒ­é—¨é¤å…ï¼Œé¿å…æ’é˜Ÿç­‰å¾…ã€‚',
        'æ ¹æ®æ‚¨çš„é¢„ç®—å’Œæ—¶é—´å®‰æ’ï¼Œæˆ‘å»ºè®®ä»¥ä¸‹è¡Œç¨‹ï¼š\n\nğŸ“… **7å¤©è¡Œç¨‹è§„åˆ’**\n**ç¬¬1-3å¤©ï¼šä¸œäº¬**\nâ€¢ æµ…è‰å¯ºã€æ™´ç©ºå¡”\nâ€¢ ç§‹å¶åŸã€æ¶©è°·\nâ€¢ è¿ªå£«å°¼ä¹å›­\n\n**ç¬¬4-5å¤©ï¼šäº¬éƒ½**\nâ€¢ é‡‘é˜å¯ºã€æ¸…æ°´å¯º\nâ€¢ å²šå±±ç«¹æ—\nâ€¢ ç¥—å›­è§’\n\n**ç¬¬6-7å¤©ï¼šå¤§é˜ª**\nâ€¢ å¤§é˜ªåŸ\nâ€¢ é“é¡¿å €ç¾é£Ÿ\nâ€¢ ç¯çƒå½±åŸ\n\néœ€è¦æˆ‘ä¸ºæ‚¨æä¾›æ›´è¯¦ç»†çš„äº¤é€šå’Œä½å®¿å»ºè®®å—ï¼Ÿ'
      ]
      
      const randomResponse = travelResponses[Math.floor(Math.random() * travelResponses.length)]
      
      const aiResponse = { 
        role: 'assistant' as const, 
        content: randomResponse,
        timestamp: new Date()
      }
      
      // Update debug stats with new metrics
      setAgentConfig(prev => ({
        ...prev,
        testHistory: [...prev.testHistory, aiResponse],
        debugStats: {
          ...prev.debugStats,
          isRunning: false,
          tokensUsed: prev.debugStats.tokensUsed + Math.floor(Math.random() * 500) + 200,
          responseTime: Math.random() * 3 + 1,
          memoryUsage: Math.min(prev.debugStats.memoryUsage + Math.floor(Math.random() * 10), 95),
          activePlugins: Math.max(prev.debugStats.activePlugins - 1, 1)
        }
      }))
      setIsTesting(false)
    }, 1500)
    
    setTestMessage('')
  }





  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50">
      <div className="max-w-7xl mx-auto px-6 py-8">
        {/* Page header */}
        <div className="mb-8">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-6">
              <Button
                variant="outlined"
                startIcon={<ArrowLeft />}
                onClick={() => navigate('/dashboard/agents')}
                className="border-gray-300 text-gray-600 hover:border-gray-400 hover:bg-gray-50"
              >
                è¿”å›
              </Button>
              <div className="flex items-center space-x-4">
                <span className="text-4xl">{agentConfig.icon}</span>
                                <div>
                  <h1 className="text-3xl font-bold text-gray-900">
                    {isNew ? 'åˆ›å»ºæ™ºèƒ½ä½“' : 'ç¼–è¾‘æ™ºèƒ½ä½“'}
                  </h1>
                  <p className="text-lg text-gray-600">
                    {isNew ? 'é…ç½®æ™ºèƒ½ä½“çš„ç³»ç»Ÿæç¤ºè¯ã€ç¼–æ’å‚æ•°å’Œè°ƒè¯•ä¿¡æ¯' : 'ä¿®æ”¹æ™ºèƒ½ä½“é…ç½®å’Œå‚æ•°'}
                  </p>
                  <p className="text-sm text-gray-500 mt-1">
                    {agentConfig.description}
                  </p>
                </div>
              </div>
            </div>
            
            <div className="flex items-center space-x-4">
              <Button
                variant="outlined"
                startIcon={<TestTube />}
                onClick={() => setActiveTab(2)}
                className="border-blue-300 text-blue-600 hover:border-blue-400 hover:bg-blue-50"
              >
                æµ‹è¯•è°ƒè¯•
              </Button>
              <Button
                variant="contained"
                startIcon={<Save />}
                onClick={handleSave}
                className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg"
              >
                ä¿å­˜é…ç½®
              </Button>
            </div>
          </div>
        </div>

        {/* Main content */}
        <Card className="shadow-xl border-0 overflow-hidden">
          <Box sx={{ borderBottom: 1, borderColor: 'divider', backgroundColor: 'white' }}>
            <Tabs 
              value={activeTab} 
              onChange={handleTabChange} 
              aria-label="æ™ºèƒ½ä½“é…ç½®æ ‡ç­¾é¡µ"
              className="px-6"
              sx={{
                '& .MuiTab-root': {
                  minHeight: '64px',
                  fontSize: '1rem',
                  fontWeight: 500,
                  textTransform: 'none',
                  color: '#6B7280',
                  '&.Mui-selected': {
                    color: '#3B82F6',
                    fontWeight: 600,
                  },
                },
                '& .MuiTabs-indicator': {
                  height: '3px',
                  borderRadius: '2px',
                  backgroundColor: '#3B82F6',
                },
              }}
            >
              <Tab 
                label={
                  <div className="flex items-center space-x-3">
                    <Brain className="w-5 h-5" />
                    <span>ç³»ç»Ÿæç¤ºè¯é…ç½®</span>
                  </div>
                } 
              />
              <Tab 
                label={
                  <div className="flex items-center space-x-3">
                    <Settings className="w-5 h-5" />
                    <span>ç¼–æ’é…ç½®</span>
                  </div>
                } 
              />
              <Tab 
                label={
                  <div className="flex items-center space-x-3">
                    <Eye className="w-5 h-5" />
                    <span>é¢„è§ˆè°ƒè¯•</span>
                  </div>
                } 
              />
            </Tabs>
          </Box>

          {/* System Prompt Configuration Tab */}
          <TabPanel value={activeTab} index={0}>
            <div className="space-y-8">
              <div className="flex items-center justify-between">
                <Typography variant="h6" className="text-gray-800 font-semibold">
                  ç³»ç»Ÿæç¤ºè¯å¼€å‘
                </Typography>
              </div>
              
                              <Paper elevation={0} className="p-6 border border-gray-200 rounded-xl">
                  <Typography variant="subtitle1" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 font-bold text-lg">
                    ç³»ç»Ÿæç¤ºè¯
                  </Typography>
                  <textarea
                    value={agentConfig.systemPrompt}
                    onChange={(e) => setAgentConfig(prev => ({ ...prev, systemPrompt: e.target.value }))}
                    placeholder="å®šä¹‰æ™ºèƒ½ä½“çš„è§’è‰²ã€èƒ½åŠ›å’Œè¡Œä¸ºå‡†åˆ™..."
                    className="mt-2 w-full p-4 border border-gray-300 rounded-lg resize-y min-h-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm leading-relaxed"
                    style={{ resize: 'vertical' }}
                  />
                  <div className="mt-6">
                    <Button
                      variant="contained"
                      startIcon={<Sparkles />}
                      onClick={() => {
                        // Auto-generate prompt based on current configuration
                        const generatedPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½åŠ©æ‰‹ï¼Œ${agentConfig.description}ã€‚

è§’è‰²å®šä¹‰ï¼š
- ä¸»è¦èŒè´£ï¼šæ™ºèƒ½åŠ©æ‰‹
- è¡Œä¸ºå‡†åˆ™ï¼šå‹å¥½ã€ä¸“ä¸šã€å‡†ç¡®
- å“åº”é£æ ¼ï¼šæ¸…æ™°ã€æœ‰ç”¨ã€åŠæ—¶

èƒ½åŠ›èŒƒå›´ï¼š
- é—®é¢˜è§£ç­”ï¼šèƒ½å¤Ÿç†è§£å¹¶å›ç­”ç”¨æˆ·çš„å„ç§é—®é¢˜
- ä»»åŠ¡ååŠ©ï¼šå¸®åŠ©ç”¨æˆ·å®Œæˆç›¸å…³ä»»åŠ¡
- ä¿¡æ¯æŸ¥è¯¢ï¼šæä¾›å‡†ç¡®çš„ä¿¡æ¯å’Œå»ºè®®

ç¤ºä¾‹å¯¹è¯ï¼š
${agentConfig.promptTuning.examples || 'ç”¨æˆ·ï¼šä½ å¥½\nåŠ©æ‰‹ï¼šæ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ'}

è¯·æ ¹æ®ä»¥ä¸Šé…ç½®ï¼Œä¸ºç”¨æˆ·æä¾›æœ€å¥½çš„æœåŠ¡ä½“éªŒã€‚`

                        setAgentConfig(prev => ({
                          ...prev,
                          systemPrompt: generatedPrompt,
                          autoGeneratedPrompt: generatedPrompt
                        }))
                        setSnackbar({ open: true, message: 'ç³»ç»Ÿæç¤ºè¯è‡ªåŠ¨ç”ŸæˆæˆåŠŸï¼', severity: 'success' })
                      }}
                      className="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700"
                    >
                      è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯
                    </Button>
                  </div>
                  
                  {/* Tips for System Prompt Development */}
                  <div className="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                    <Typography variant="subtitle2" className="mb-3 text-blue-800 font-semibold flex items-center">
                      <Brain className="w-5 h-5 mr-2" />
                      ç³»ç»Ÿæç¤ºè¯å¼€å‘æŠ€å·§
                    </Typography>
                    <div className="space-y-2 text-sm text-blue-700">
                      <div className="flex items-start">
                        <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span><strong>è§’è‰²å®šä¹‰ï¼š</strong>æ˜ç¡®æ™ºèƒ½ä½“çš„èº«ä»½ã€ä¸“ä¸šé¢†åŸŸå’Œä¸»è¦èŒè´£</span>
                      </div>
                      <div className="flex items-start">
                        <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span><strong>è¡Œä¸ºå‡†åˆ™ï¼š</strong>è®¾å®šæ™ºèƒ½ä½“çš„è¡Œä¸ºè§„èŒƒã€å“åº”é£æ ¼å’Œæ²Ÿé€šæ–¹å¼</span>
                      </div>
                      <div className="flex items-start">
                        <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span><strong>èƒ½åŠ›èŒƒå›´ï¼š</strong>è¯¦ç»†æè¿°æ™ºèƒ½ä½“èƒ½å¤Ÿå®Œæˆçš„ä»»åŠ¡å’Œæä¾›çš„æœåŠ¡</span>
                      </div>
                      <div className="flex items-start">
                        <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span><strong>ç¤ºä¾‹å¯¹è¯ï¼š</strong>æä¾›å…¸å‹çš„ç”¨æˆ·äº¤äº’åœºæ™¯å’ŒæœŸæœ›çš„å›å¤æ ¼å¼</span>
                      </div>
                      <div className="flex items-start">
                        <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span><strong>é™åˆ¶è¯´æ˜ï¼š</strong>æ˜ç¡®æ™ºèƒ½ä½“çš„èƒ½åŠ›è¾¹ç•Œå’Œä¸èƒ½å¤„ç†çš„æƒ…å†µ</span>
                      </div>
                    </div>
                  </div>
                </Paper>

              {agentConfig.editMode === 'ai' && (
                <Alert severity="info" icon={<Sparkles className="w-6 h-6" />} className="border border-blue-200 bg-blue-50">
                  <Typography variant="body1" className="text-blue-800">
                    <strong>æç¤ºè¯è‡ªåŠ¨ç”Ÿæˆï¼š</strong>
                    ç³»ç»Ÿå·²æ ¹æ®æ‚¨çš„æè¿°è‡ªåŠ¨ç”Ÿæˆäº†ç³»ç»Ÿæç¤ºè¯ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚
                  </Typography>
                </Alert>
              )}

              <Divider className="my-8" />

              {/* Prompt Tuning Section */}
              <div>
                <div className="mb-6">
                  <Typography variant="h6" className="text-gray-800 font-semibold">
                    æç¤ºè¯è°ƒä¼˜
                  </Typography>
                </div>
                
                {/* Dataset Configuration */}
                <Paper elevation={0} className="p-6 border border-gray-200 rounded-xl mb-6">
                  <Typography variant="subtitle1" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-red-600 font-bold text-lg">
                    æ•°æ®é›†é…ç½®
                  </Typography>
                  
                  {/* Toggle between Upload and Manual Input */}
                  <div className="mb-6">
                    <div className="flex items-center space-x-4 mb-4">
                      <FormControlLabel
                        control={
                          <Switch
                            checked={agentConfig.promptTuning.inputMode === 'upload'}
                            onChange={(e) => setAgentConfig(prev => ({
                              ...prev,
                              promptTuning: {
                                ...prev.promptTuning,
                                inputMode: e.target.checked ? 'upload' : 'manual'
                              }
                            }))}
                            color="primary"
                          />
                        }
                        label={
                          <Typography variant="subtitle2" className="text-gray-700 font-medium">
                            ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ 
                          </Typography>
                        }
                      />
                      <Typography variant="body2" className="text-gray-500">
                        {agentConfig.promptTuning.inputMode === 'upload' ? 'æ–‡ä»¶ä¸Šä¼ æ¨¡å¼' : 'æ‰‹åŠ¨è¾“å…¥æ¨¡å¼'}
                      </Typography>
                    </div>
                  </div>

                  {/* File Upload Mode */}
                  {agentConfig.promptTuning.inputMode === 'upload' && (
                    <div>
                      {/* Upload Header Row */}
                      <div className="flex items-center justify-between mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <div className="flex items-center space-x-3">
                          <Typography variant="subtitle1" className="text-gray-800 font-medium">
                            ç”¨æˆ·ç”¨ä¾‹åˆ—è¡¨
                          </Typography>
                          <Typography variant="body2" className="text-gray-500">
                            æ”¯æŒ JSONã€CSVã€TXT æ ¼å¼æ–‡ä»¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶ä¸­çš„å…·ä½“ç”¨ä¾‹
                          </Typography>
                        </div>
                        <div className="flex items-center space-x-3">
                          <input
                            type="file"
                            accept=".json,.csv,.txt"
                            onChange={(e) => {
                              const file = e.target.files?.[0]
                              if (file) {
                                const reader = new FileReader()
                                reader.onload = (event) => {
                                  try {
                                    const content = event.target?.result as string
                                    // Parse content based on file type
                                    let parsedData
                                    if (file.name.endsWith('.json')) {
                                      parsedData = JSON.parse(content)
                                    } else if (file.name.endsWith('.csv')) {
                                      // Simple CSV parsing
                                      const lines = content.split('\n')
                                      const headers = lines[0].split(',')
                                      parsedData = lines.slice(1).map(line => {
                                        const values = line.split(',')
                                        return headers.reduce((obj, header, index) => {
                                          obj[header.trim()] = values[index]?.trim() || ''
                                          return obj
                                        }, {} as any)
                                      })
                                    } else {
                                      // Text file - convert to structured format
                                      const lines = content.split('\n').filter(line => line.trim())
                                      parsedData = lines.map(line => {
                                        if (line.includes('ï¼š')) {
                                          const [user, assistant] = line.split('ï¼š', 2)
                                          return { user: user.trim(), assistant: assistant.trim() }
                                        } else {
                                          return { user: line.trim(), assistant: 'è¯·æä¾›ç›¸åº”çš„å›å¤' }
                                        }
                                      })
                                    }
                                    
                                    setAgentConfig(prev => ({
                                      ...prev,
                                      promptTuning: {
                                        ...prev.promptTuning,
                                        useCases: [...(prev.promptTuning.useCases || []), {
                                          id: Date.now(),
                                          name: file.name,
                                          data: parsedData,
                                          uploadTime: new Date(),
                                          status: 'active',
                                          examples: parsedData.length || 1
                                        }]
                                      }
                                    }))
                                    setSnackbar({ open: true, message: 'ç”¨æˆ·ç”¨ä¾‹ä¸Šä¼ æˆåŠŸï¼', severity: 'success' })
                                  } catch (error) {
                                    setSnackbar({ open: true, message: 'æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', severity: 'error' })
                                  }
                                }
                                reader.readAsText(file)
                              }
                            }}
                            className="hidden"
                            id="use-case-upload"
                          />
                          <label htmlFor="use-case-upload">
                            <IconButton
                              component="span"
                              className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-full transition-all duration-200"
                            >
                              <Upload className="w-5 h-5" />
                            </IconButton>
                          </label>
                          <IconButton
                            className="p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-full transition-all duration-200"
                            onClick={() => {
                              setAgentConfig(prev => ({
                                ...prev,
                                promptTuning: {
                                  ...prev.promptTuning,
                                  useCases: []
                                }
                              }))
                              setSnackbar({ open: true, message: 'æ‰€æœ‰ç”¨ä¾‹é›†å·²æ¸…ç©º', severity: 'success' })
                            }}
                          >
                            <Trash2 className="w-5 h-5" />
                          </IconButton>
                        </div>
                      </div>

                      {/* User Cases Table */}
                      <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <table className="min-w-full divide-y divide-gray-200">
                          <thead className="bg-gray-50">
                            <tr>
                              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ç”¨æˆ·è¾“å…¥
                              </th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                åŠ©æ‰‹å›å¤
                              </th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                æ¥æºæ–‡ä»¶
                              </th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                æ“ä½œ
                              </th>
                            </tr>
                          </thead>
                          <tbody className="bg-white divide-y divide-gray-200">
                            {agentConfig.promptTuning.useCases && agentConfig.promptTuning.useCases.length > 0 ? (
                              agentConfig.promptTuning.useCases.flatMap((useCase) => 
                                (Array.isArray(useCase.data) ? useCase.data : []).map((item, index) => (
                                  <tr key={`${useCase.id}-${index}`} className="hover:bg-gray-50">
                                    <td className="px-6 py-4">
                                      <div className="text-sm text-gray-900 max-w-xs">
                                        {item.user}
                                      </div>
                                    </td>
                                    <td className="px-6 py-4">
                                      <div className="text-sm text-gray-900 max-w-xs">
                                        {item.assistant}
                                      </div>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                      {useCase.name}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                      <div className="flex items-center space-x-2">
                                        <IconButton
                                          size="small"
                                          className="p-1 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded"
                                          onClick={() => {
                                            // Mock edit functionality
                                            setSnackbar({ open: true, message: 'ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })
                                          }}
                                        >
                                          <Edit3 className="w-4 h-4" />
                                        </IconButton>
                                        <IconButton
                                          size="small"
                                          className="p-1 bg-red-100 hover:bg-red-200 text-red-600 rounded"
                                          onClick={() => {
                                            // Remove this specific user case
                                                                                         const updatedData = useCase.data.filter((_, i: number) => i !== index)
                                            if (updatedData.length === 0) {
                                              // If no more data in this file, remove the entire file
                                              setAgentConfig(prev => ({
                                                ...prev,
                                                promptTuning: {
                                                  ...prev.promptTuning,
                                                  useCases: prev.promptTuning.useCases?.filter(uc => uc.id !== useCase.id) || []
                                                }
                                              }))
                                            } else {
                                              // Update the file with remaining data
                                              setAgentConfig(prev => ({
                                                ...prev,
                                                promptTuning: {
                                                  ...prev.promptTuning,
                                                  useCases: prev.promptTuning.useCases?.map(uc => 
                                                    uc.id === useCase.id 
                                                      ? { ...uc, data: updatedData }
                                                      : uc
                                                  ) || []
                                                }
                                              }))
                                            }
                                            setSnackbar({ open: true, message: 'ç”¨æˆ·ç”¨ä¾‹å·²åˆ é™¤', severity: 'success' })
                                          }}
                                        >
                                          <Trash2 className="w-4 h-4" />
                                        </IconButton>
                                      </div>
                                    </td>
                                  </tr>
                                ))
                              )
                            ) : (
                              <tr>
                                <td colSpan={4} className="px-6 py-12 text-center">
                                  <div className="flex flex-col items-center space-y-3">
                                    <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                                      <Upload className="w-6 h-6 text-gray-400" />
                                    </div>
                                    <div>
                                      <Typography variant="body1" className="text-gray-500 font-medium">
                                        æš‚æ— ç”¨æˆ·ç”¨ä¾‹
                                      </Typography>
                                      <Typography variant="body2" className="text-gray-400">
                                        ç‚¹å‡»ä¸Šæ–¹ä¸Šä¼ å›¾æ ‡æ·»åŠ ç”¨ä¾‹é›†
                                      </Typography>
                                    </div>
                                  </div>
                                </td>
                              </tr>
                            )}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  )}

                  {/* Manual Input Mode */}
                  {agentConfig.promptTuning.inputMode === 'manual' && (
                    <div>
                      <Typography variant="subtitle2" className="mb-3 text-gray-700 font-medium">
                        æ‰‹åŠ¨è¾“å…¥ç¤ºä¾‹å¯¹è¯
                      </Typography>
                      <TextField
                        fullWidth
                        multiline
                        rows={6}
                        value={agentConfig.promptTuning.examples}
                        onChange={(e) => setAgentConfig(prev => ({
                          ...prev,
                          promptTuning: { ...prev.promptTuning, examples: e.target.value }
                        }))}
                        placeholder="æä¾›ä¸€äº›ç¤ºä¾‹å¯¹è¯æ¥æŒ‡å¯¼æ™ºèƒ½ä½“çš„å“åº”æ¨¡å¼..."
                        className="mt-2"
                      />
                      <Typography variant="body2" className="text-gray-500 mt-2">
                        è¯·è¾“å…¥ç”¨æˆ·å’ŒåŠ©æ‰‹çš„å¯¹è¯ç¤ºä¾‹ï¼Œæ¯è¡Œä¸€ä¸ªå¯¹è¯è½®æ¬¡
                      </Typography>
                    </div>
                  )}
                </Paper>

                {/* Optimization Strategy */}
                <Paper elevation={0} className="p-6 border border-gray-200 rounded-xl">
                  <Typography variant="subtitle1" className="mb-4 text-gray-700 font-medium">
                    ä¼˜åŒ–ç­–ç•¥
                  </Typography>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <FormControl fullWidth>
                      <Typography variant="subtitle2" className="mb-3 text-gray-700 font-medium">
                        ä¼˜åŒ–æ¨¡å‹
                      </Typography>
                      <Select
                        value={agentConfig.promptTuning.optimizationModel || 'gpt-4'}
                        onChange={(e) => setAgentConfig(prev => ({
                          ...prev,
                          promptTuning: { 
                            ...prev.promptTuning, 
                            optimizationModel: e.target.value 
                          }
                        }))}
                        className="mt-2"
                      >
                        <MenuItem value="gpt-4">GPT-4</MenuItem>
                        <MenuItem value="gpt-3.5-turbo">GPT-3.5 Turbo</MenuItem>
                        <MenuItem value="claude-3">Claude-3</MenuItem>
                        <MenuItem value="gemini-pro">Gemini Pro</MenuItem>
                        <MenuItem value="qwen-plus">Qwen Plus</MenuItem>
                      </Select>
                    </FormControl>

                    <FormControl fullWidth>
                      <Typography variant="subtitle2" className="mb-3 text-gray-700 font-medium">
                        ç®—æ³•è¯„ä¼°æ¨¡å‹
                      </Typography>
                      <Select
                        value={agentConfig.promptTuning.evaluationModel || 'gpt-4'}
                        onChange={(e) => setAgentConfig(prev => ({
                          ...prev,
                          promptTuning: { 
                            ...prev.promptTuning, 
                            evaluationModel: e.target.value 
                          }
                        }))}
                        className="mt-2"
                      >
                        <MenuItem value="gpt-4">GPT-4</MenuItem>
                        <MenuItem value="gpt-3.5-turbo">GPT-3.5 Turbo</MenuItem>
                        <MenuItem value="claude-3">Claude-3</MenuItem>
                        <MenuItem value="gemini-pro">Gemini Pro</MenuItem>
                        <MenuItem value="qwen-plus">Qwen Plus</MenuItem>
                      </Select>
                    </FormControl>

                    <FormControl fullWidth>
                      <Typography variant="subtitle2" className="mb-3 text-gray-700 font-medium">
                        ä¼˜åŒ–è½®æ•°
                      </Typography>
                      <TextField
                        fullWidth
                        type="number"
                        value={agentConfig.promptTuning.optimizationRounds || 3}
                        onChange={(e) => setAgentConfig(prev => ({
                          ...prev,
                          promptTuning: { 
                            ...prev.promptTuning, 
                            optimizationRounds: parseInt(e.target.value) 
                          }
                        }))}
                        inputProps={{ min: 1, max: 10, step: 1 }}
                        helperText="å»ºè®®è®¾ç½® 3-5 è½®"
                        className="mt-2"
                      />
                    </FormControl>


                  </div>

                  <div className="mt-6">
                    <Button
                      variant="contained"
                      startIcon={<Sparkles />}
                      onClick={() => {
                        // Simulate optimization process
                        setSnackbar({ open: true, message: 'å¼€å§‹ä¼˜åŒ–æç¤ºè¯...', severity: 'info' })
                        // Here you would implement the actual optimization logic
                      }}
                      className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700"
                    >
                      å¼€å§‹ä¼˜åŒ–
                    </Button>
                  </div>

                  {/* Optimization Tips */}
                  <Alert 
                    severity="info" 
                    icon={<Sparkles className="w-6 h-6" />}
                    className="border border-purple-200 bg-purple-50 mt-6"
                  >
                                      <Typography variant="body1" className="text-purple-800">
                    <strong>è‡ªåŠ¨è°ƒä¼˜æç¤ºè¯ï¼š</strong>
                    ç³»ç»Ÿå°†æ ¹æ®æ‚¨é…ç½®çš„ä¼˜åŒ–æ¨¡å‹ã€è¯„ä¼°æ¨¡å‹å’Œä¼˜åŒ–è½®æ•°ï¼Œè‡ªåŠ¨ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯ã€‚
                    ä¼˜åŒ–è¿‡ç¨‹å°†ç»“åˆä¸Šä¼ çš„ç”¨ä¾‹é›†æˆ–æ‰‹åŠ¨è¾“å…¥çš„ç¤ºä¾‹å¯¹è¯ï¼Œç”Ÿæˆæ›´ç²¾å‡†çš„æç¤ºè¯é…ç½®ã€‚
                  </Typography>
                  </Alert>
                </Paper>
              </div>
            </div>
          </TabPanel>

          {/* Orchestration Configuration Tab */}
          <TabPanel value={activeTab} index={1}>
            <div className="space-y-8">
              {/* Model Selection */}
              <Accordion defaultExpanded className="shadow-lg border-2 border-gradient-to-r from-blue-100 to-purple-100 rounded-2xl bg-gradient-to-br from-white to-blue-50">
                <AccordionSummary 
                  expandIcon={<ChevronDown className="w-6 h-6 text-blue-600 transform transition-transform duration-200" />} 
                  className="px-6 py-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-300"
                >
                  <Typography variant="h6" className="flex items-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 font-bold text-lg">
                    <Zap className="mr-3 w-6 h-6 text-yellow-500 drop-shadow-sm" />
                    æ¨¡å‹é€‰æ‹©ä¸é…ç½®
                  </Typography>
                </AccordionSummary>
                <AccordionDetails className="px-6 pb-6">
                  <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <FormControl fullWidth>
                        <Typography variant="subtitle1" className="mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                          LLMæ¨¡å‹
                        </Typography>
                        <Select
                          value={agentConfig.model}
                          onChange={(e) => setAgentConfig(prev => ({ ...prev, model: e.target.value }))}
                          className="border-2 border-blue-200 rounded-lg hover:border-blue-400 transition-all duration-300"
                          size="medium"
                          sx={{
                            '& .MuiOutlinedInput-root': {
                              height: '56px',
                              '&:hover fieldset': {
                                borderColor: '#60a5fa',
                              },
                              '&.Mui-focused fieldset': {
                                borderColor: '#3b82f6',
                              },
                            },
                          }}
                        >
                          <MenuItem value="gpt-4">GPT-4</MenuItem>
                          <MenuItem value="gpt-3.5-turbo">GPT-3.5 Turbo</MenuItem>
                          <MenuItem value="claude-3">Claude-3</MenuItem>
                          <MenuItem value="gemini-pro">Gemini Pro</MenuItem>
                          <MenuItem value="qwen-plus">Qwen Plus</MenuItem>
                        </Select>
                        <FormHelperText className="mt-2 text-sm text-gray-500">
                          é€‰æ‹©é€‚åˆæ‚¨éœ€æ±‚çš„AIè¯­è¨€æ¨¡å‹ï¼Œä¸åŒæ¨¡å‹åœ¨æ€§èƒ½å’Œæˆæœ¬ä¸Šæœ‰æ‰€å·®å¼‚
                        </FormHelperText>
                      </FormControl>

                      <FormControl fullWidth>
                        <Typography variant="subtitle1" className="mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                          æ¸©åº¦ (Temperature)
                        </Typography>
                        <TextField
                          fullWidth
                          type="number"
                          value={agentConfig.modelParams.temperature}
                          onChange={(e) => setAgentConfig(prev => ({
                            ...prev,
                            modelParams: { ...prev.modelParams, temperature: parseFloat(e.target.value) }
                          }))}
                          inputProps={{ min: 0, max: 2, step: 0.1 }}
                          helperText="æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§"
                          className="mt-2 border-2 border-blue-200 rounded-lg hover:border-blue-400 transition-all duration-300"
                          size="medium"
                          sx={{
                            '& .MuiOutlinedInput-root': {
                              height: '56px',
                              '&:hover fieldset': {
                                borderColor: '#60a5fa',
                              },
                              '&.Mui-focused fieldset': {
                                borderColor: '#3b82f6',
                              },
                            },
                          }}
                        />
                      </FormControl>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <FormControl fullWidth>
                        <Typography variant="subtitle1" className="mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                          æœ€å¤§Tokenæ•°
                        </Typography>
                        <TextField
                          fullWidth
                          type="number"
                          value={agentConfig.modelParams.maxTokens}
                          onChange={(e) => setAgentConfig(prev => ({
                            ...prev,
                            modelParams: { ...prev.modelParams, maxTokens: parseInt(e.target.value) }
                          }))}
                          inputProps={{ min: 1, max: 8000 }}
                          helperText="é™åˆ¶å•æ¬¡å¯¹è¯çš„æœ€å¤§è¾“å‡ºé•¿åº¦"
                          className="mt-2"
                          size="medium"
                        />
                      </FormControl>

                      <FormControl fullWidth>
                        <Typography variant="subtitle1" className="mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                          Top P
                        </Typography>
                        <TextField
                          fullWidth
                          type="number"
                          value={agentConfig.modelParams.topP}
                          onChange={(e) => setAgentConfig(prev => ({
                            ...prev,
                            modelParams: { ...prev.modelParams, topP: parseFloat(e.target.value) }
                          }))}
                          inputProps={{ min: 0, max: 1, step: 0.1 }}
                          helperText="æ§åˆ¶è¯æ±‡é€‰æ‹©çš„å¤šæ ·æ€§"
                          className="mt-2"
                          size="medium"
                        />
                      </FormControl>
                    </div>
                  </div>
                </AccordionDetails>
              </Accordion>

              {/* Skills Configuration */}
              <Accordion defaultExpanded className="shadow-lg border-2 border-gradient-to-r from-green-100 to-emerald-100 rounded-2xl bg-gradient-to-br from-white to-green-50">
                <AccordionSummary 
                  expandIcon={<ChevronDown className="w-6 h-6 text-green-600 transform transition-transform duration-200" />} 
                  className="px-6 py-4 hover:bg-gradient-to-r hover:from-green-50 hover:to-emerald-50 transition-all duration-300"
                >
                  <Typography variant="h6" className="flex items-center text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600 font-bold text-lg">
                    <Plug className="mr-3 w-6 h-6 text-green-500 drop-shadow-sm" />
                    æŠ€èƒ½é…ç½®
                  </Typography>
                </AccordionSummary>
                <AccordionDetails className="px-6 pb-6">
                  <div className="space-y-6">
                    {/* Plugins Section */}
                    <Accordion className="shadow-md border-2 border-green-200 rounded-xl bg-gradient-to-r from-green-50 to-emerald-50">
                      <AccordionSummary 
                        expandIcon={<ChevronDown className="w-5 h-5 text-green-600 transform transition-transform duration-200" />} 
                        className="px-4 py-3 hover:bg-green-100 transition-all duration-300"
                      >
                        <Typography variant="subtitle1" className="text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600 font-bold text-lg flex items-center">
                          <Plug className="mr-3 w-6 h-6 text-green-500 drop-shadow-sm" />
                          æ’ä»¶é€‰æ‹©
                        </Typography>
                      </AccordionSummary>
                                            <AccordionDetails className="px-4 pb-4">
                        <div className="space-y-4">
                          <div className="space-y-3">
                            {[
                              { 
                                id: 'baidu_maps', 
                                name: 'ç™¾åº¦åœ°å›¾', 
                                description: 'æä¾›åœ°å›¾å¯¼èˆªã€åœ°ç‚¹æœç´¢ã€è·¯çº¿è§„åˆ’ç­‰æœåŠ¡',
                                icon: 'ğŸ—ºï¸',
                                category: 'åœ°å›¾æœåŠ¡',
                                status: 'active',
                                version: 'v2.1.0'
                              },
                              { 
                                id: 'weather_service', 
                                name: 'å¤©æ°”æœåŠ¡', 
                                description: 'å®æ—¶å¤©æ°”ä¿¡æ¯ã€å¤©æ°”é¢„æŠ¥ã€ç©ºæ°”è´¨é‡ç­‰',
                                icon: 'ğŸŒ¤ï¸',
                                category: 'å¤©æ°”æœåŠ¡',
                                status: 'active',
                                version: 'v1.8.5'
                              },
                              { 
                                id: 'airline_tickets', 
                                name: 'èˆªç©ºç¥¨åŠ¡', 
                                description: 'èˆªç­æŸ¥è¯¢ã€æœºç¥¨é¢„è®¢ã€ä»·æ ¼æ¯”è¾ƒç­‰',
                                icon: 'âœˆï¸',
                                category: 'ç¥¨åŠ¡æœåŠ¡',
                                status: 'active',
                                version: 'v3.2.1'
                              },
                              { 
                                id: 'web_search', 
                                name: 'ç½‘ç»œæœç´¢', 
                                description: 'å®æ—¶ç½‘ç»œä¿¡æ¯æœç´¢å’ŒæŸ¥è¯¢',
                                icon: 'ğŸ”',
                                category: 'æœç´¢æœåŠ¡',
                                status: 'active',
                                version: 'v2.0.0'
                              },
                              { 
                                id: 'calculator', 
                                name: 'è®¡ç®—å™¨', 
                                description: 'æ•°å­¦è®¡ç®—ã€å•ä½è½¬æ¢ã€å…¬å¼æ±‚è§£ç­‰',
                                icon: 'ğŸ§®',
                                category: 'å·¥å…·æœåŠ¡',
                                status: 'active',
                                version: 'v1.5.2'
                              },
                              { 
                                id: 'file_reader', 
                                name: 'æ–‡ä»¶è¯»å–', 
                                description: 'æ”¯æŒå¤šç§æ ¼å¼æ–‡ä»¶çš„è¯»å–å’Œè§£æ',
                                icon: 'ğŸ“',
                                category: 'æ–‡ä»¶æœåŠ¡',
                                status: 'active',
                                version: 'v2.3.0'
                              },
                              { 
                                id: 'image_generator', 
                                name: 'å›¾åƒç”Ÿæˆ', 
                                description: 'AIå›¾åƒç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½',
                                icon: 'ğŸ¨',
                                category: 'AIæœåŠ¡',
                                status: 'active',
                                version: 'v1.9.8'
                              },
                              { 
                                id: 'code_interpreter', 
                                name: 'ä»£ç è§£é‡Šå™¨', 
                                description: 'ä»£ç æ‰§è¡Œã€è°ƒè¯•å’Œè§£é‡ŠåŠŸèƒ½',
                                icon: 'ğŸ’»',
                                category: 'å¼€å‘å·¥å…·',
                                status: 'active',
                                version: 'v2.5.1'
                              }
                            ].map((plugin) => (
                              <div
                                key={plugin.id}
                                className={`p-4 rounded-xl border-2 transition-all duration-300 cursor-pointer ${
                                  agentConfig.plugins.includes(plugin.id)
                                    ? 'border-green-400 bg-gradient-to-r from-green-50 to-emerald-50 shadow-lg scale-[1.02]'
                                    : 'border-gray-200 bg-white hover:border-green-300 hover:shadow-md hover:scale-[1.01]'
                                }`}
                                onClick={() => {
                                  const isSelected = agentConfig.plugins.includes(plugin.id)
                                  setAgentConfig(prev => ({
                                    ...prev,
                                    plugins: isSelected 
                                      ? prev.plugins.filter(p => p !== plugin.id)
                                      : [...prev.plugins, plugin.id]
                                  }))
                                }}
                              >
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center space-x-4 flex-1">
                                    <div className={`w-12 h-12 rounded-lg flex items-center justify-center text-2xl ${
                                      agentConfig.plugins.includes(plugin.id)
                                        ? 'bg-green-100'
                                        : 'bg-gray-100'
                                    }`}>
                                      {plugin.icon}
                                    </div>
                                    <div className="flex-1">
                                      <div className="flex items-center space-x-3 mb-1">
                                        <h4 className={`font-semibold text-lg ${
                                          agentConfig.plugins.includes(plugin.id)
                                            ? 'text-green-800'
                                            : 'text-gray-800'
                                        }`}>
                                          {plugin.name}
                                        </h4>
                                        <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-full">
                                          {plugin.category}
                                        </span>
                                        <span className="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">
                                          {plugin.version}
                                        </span>
                                      </div>
                                      <p className="text-gray-600 text-sm leading-relaxed">
                                        {plugin.description}
                                      </p>
                                    </div>
                                  </div>
                                  
                                  <div className="flex items-center space-x-2 ml-4">
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${plugin.name} å‚æ•°é…ç½®åŠŸèƒ½å¼€å‘ä¸­...`, severity: 'info' })
                                      }}
                                      title="å‚æ•°é…ç½®"
                                    >
                                      <Settings className="w-4 h-4" />
                                    </IconButton>
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-green-100 hover:bg-green-200 text-green-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${plugin.name} å·²å¤åˆ¶åˆ°å‰ªè´´æ¿`, severity: 'success' })
                                      }}
                                      title="å¤åˆ¶æ’ä»¶"
                                    >
                                      <Copy className="w-4 h-4" />
                                    </IconButton>
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${plugin.name} åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...`, severity: 'info' })
                                      }}
                                      title="åˆ é™¤æ’ä»¶"
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </IconButton>
                                  </div>
                                </div>
                                
                                {agentConfig.plugins.includes(plugin.id) && (
                                  <div className="mt-3 pt-3 border-t border-green-200">
                                    <div className="flex items-center space-x-2">
                                      <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                      <span className="text-sm text-green-700 font-medium">å·²å¯ç”¨</span>
                                    </div>
                                  </div>
                                )}
                              </div>
                            ))}
                          </div>
                          
                          <div className="flex items-center justify-between pt-4 border-t border-gray-200">
                            <div className="flex items-center space-x-3">
                              <Button
                                variant="outlined"
                                size="small"
                                startIcon={<Plus className="w-4 h-4" />}
                                onClick={() => setSnackbar({ open: true, message: 'æ·»åŠ æ–°æ’ä»¶åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                                className="border-2 border-green-300 text-green-700 hover:border-green-500 hover:bg-green-50 hover:text-green-800 transition-all duration-300 font-medium px-4 py-2 rounded-lg"
                              >
                                æ·»åŠ æ–°æ’ä»¶
                              </Button>
                              <Button
                                variant="outlined"
                                size="small"
                                startIcon={<Download className="w-4 h-4" />}
                                onClick={() => setSnackbar({ open: true, message: 'æ‰¹é‡å¯¼å…¥æ’ä»¶åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                                className="border-2 border-blue-300 text-blue-700 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-800 transition-all duration-300 font-medium px-4 py-2 rounded-lg"
                              >
                                æ‰¹é‡å¯¼å…¥
                              </Button>
                            </div>
                            <Typography variant="body2" className="text-gray-500 font-medium">
                              å·²é€‰æ‹© <span className="text-green-600 font-bold">{agentConfig.plugins.length}</span> ä¸ªæ’ä»¶
                            </Typography>
                          </div>
                        </div>
                      </AccordionDetails>
                    </Accordion>

                    {/* Workflows Section */}
                    <Accordion className="shadow-md border-2 border-emerald-200 rounded-xl bg-gradient-to-r from-emerald-50 to-teal-50">
                      <AccordionSummary 
                        expandIcon={<ChevronDown className="w-5 h-5 text-emerald-600 transform transition-transform duration-200" />} 
                        className="px-4 py-3 hover:bg-emerald-100 transition-all duration-300"
                      >
                        <Typography variant="subtitle1" className="text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600 font-bold text-lg flex items-center">
                          <Zap className="mr-3 w-6 h-6 text-emerald-500 drop-shadow-sm" />
                          å·¥ä½œæµé€‰æ‹©
                        </Typography>
                      </AccordionSummary>
                      <AccordionDetails className="px-4 pb-4">
                        <div className="space-y-4">
                          <div className="space-y-3">
                            {[
                              { 
                                id: '1', 
                                name: 'è®¢å•å¤„ç†æµç¨‹', 
                                description: 'è‡ªåŠ¨åŒ–è®¢å•å¤„ç†å’ŒçŠ¶æ€æ›´æ–°ï¼ŒåŒ…æ‹¬åº“å­˜æ£€æŸ¥ã€æ”¯ä»˜éªŒè¯å’Œå‘è´§é€šçŸ¥',
                                icon: 'ğŸ“¦',
                                category: 'ç”µå•†æµç¨‹',
                                status: 'running',
                                version: 'v2.1.0',
                                nodes: 12,
                                successRate: 98.5
                              },
                              { 
                                id: '2', 
                                name: 'ç”¨æˆ·åé¦ˆåˆ†æ', 
                                description: 'æ”¶é›†å’Œåˆ†æç”¨æˆ·åé¦ˆæ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆæ´å¯ŸæŠ¥å‘Šå’Œä¼˜å…ˆçº§å»ºè®®',
                                icon: 'ğŸ“Š',
                                category: 'æ•°æ®åˆ†æ',
                                status: 'completed',
                                version: 'v1.8.5',
                                nodes: 8,
                                successRate: 100
                              },
                              { 
                                id: '3', 
                                name: 'æ•°æ®åŒæ­¥æµç¨‹', 
                                description: 'å¤šç³»ç»Ÿæ•°æ®åŒæ­¥å’Œå¤‡ä»½ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§',
                                icon: 'ğŸ”„',
                                category: 'æ•°æ®ç®¡ç†',
                                status: 'scheduled',
                                version: 'v3.2.1',
                                nodes: 15,
                                successRate: 95.2
                              }
                            ].map((workflow) => (
                              <div
                                key={workflow.id}
                                className={`p-4 rounded-xl border-2 transition-all duration-300 cursor-pointer ${
                                  agentConfig.workflows.includes(workflow.id)
                                    ? 'border-emerald-400 bg-gradient-to-r from-emerald-50 to-teal-50 shadow-lg scale-[1.02]'
                                    : 'border-gray-200 bg-white hover:border-emerald-300 hover:shadow-md hover:scale-[1.01]'
                                }`}
                                onClick={() => {
                                  const isSelected = agentConfig.workflows.includes(workflow.id)
                                  setAgentConfig(prev => ({
                                    ...prev,
                                    workflows: isSelected 
                                      ? prev.workflows.filter(w => w !== workflow.id)
                                      : [...prev.workflows, workflow.id]
                                  }))
                                }}
                              >
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center space-x-4 flex-1">
                                    <div className={`w-12 h-12 rounded-lg flex items-center justify-center text-2xl ${
                                      agentConfig.workflows.includes(workflow.id)
                                        ? 'bg-emerald-100'
                                        : 'bg-gray-100'
                                    }`}>
                                      {workflow.icon}
                                    </div>
                                    <div className="flex-1">
                                      <div className="flex items-center space-x-3 mb-1">
                                        <h4 className={`font-semibold text-lg ${
                                          agentConfig.workflows.includes(workflow.id)
                                            ? 'text-emerald-800'
                                            : 'text-gray-800'
                                        }`}>
                                          {workflow.name}
                                        </h4>
                                        <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-full">
                                          {workflow.category}
                                        </span>
                                        <span className="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">
                                          {workflow.version}
                                        </span>
                                      </div>
                                      <p className="text-gray-600 text-sm leading-relaxed mb-2">
                                        {workflow.description}
                                      </p>
                                      <div className="flex items-center space-x-4 text-xs text-gray-500">
                                        <span>èŠ‚ç‚¹: {workflow.nodes}</span>
                                        <span>æˆåŠŸç‡: {workflow.successRate}%</span>
                                      </div>
                                    </div>
                                  </div>
                                  
                                  <div className="flex items-center space-x-2 ml-4">
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${workflow.name} å·¥ä½œæµé…ç½®åŠŸèƒ½å¼€å‘ä¸­...`, severity: 'info' })
                                      }}
                                      title="å·¥ä½œæµé…ç½®"
                                    >
                                      <Settings className="w-4 h-4" />
                                    </IconButton>
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-green-100 hover:bg-green-200 text-green-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${workflow.name} å·¥ä½œæµå·²å¤åˆ¶åˆ°å‰ªè´´æ¿`, severity: 'success' })
                                      }}
                                      title="å¤åˆ¶å·¥ä½œæµ"
                                    >
                                      <Copy className="w-4 h-4" />
                                    </IconButton>
                                    <IconButton
                                      size="small"
                                      className="p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all duration-200"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        setSnackbar({ open: true, message: `${workflow.name} å·¥ä½œæµåˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...`, severity: 'info' })
                                      }}
                                      title="åˆ é™¤å·¥ä½œæµ"
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </IconButton>
                                  </div>
                                </div>
                                
                                {agentConfig.workflows.includes(workflow.id) && (
                                  <div className="mt-3 pt-3 border-t border-emerald-200">
                                    <div className="flex items-center space-x-2">
                                      <div className="w-2 h-2 bg-emerald-500 rounded-full"></div>
                                      <span className="text-sm text-emerald-700 font-medium">å·²å¯ç”¨</span>
                                    </div>
                                  </div>
                                )}
                              </div>
                            ))}
                          </div>
                          
                          <div className="flex items-center justify-between pt-4 border-t border-gray-200">
                            <div className="flex items-center space-x-3">
                              <Button
                                variant="outlined"
                                size="small"
                                startIcon={<Plus className="w-4 h-4" />}
                                onClick={() => navigate('/dashboard/workflows/new')}
                                className="border-2 border-emerald-300 text-emerald-700 hover:border-emerald-400 hover:bg-emerald-50 hover:text-emerald-800 transition-all duration-300 font-medium px-4 py-2 rounded-lg"
                              >
                                æ·»åŠ æ–°å·¥ä½œæµ
                              </Button>
                              <Button
                                variant="outlined"
                                size="small"
                                startIcon={<Download className="w-4 h-4" />}
                                onClick={() => setSnackbar({ open: true, message: 'æ‰¹é‡å¯¼å…¥å·¥ä½œæµåŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                                className="border-2 border-blue-300 text-blue-700 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-800 transition-all duration-300 font-medium px-4 py-2 rounded-lg"
                              >
                                æ‰¹é‡å¯¼å…¥
                              </Button>
                            </div>
                            <Typography variant="body2" className="text-gray-500 font-medium">
                              å·²é€‰æ‹© <span className="text-emerald-600 font-bold">{agentConfig.workflows.length}</span> ä¸ªå·¥ä½œæµ
                            </Typography>
                          </div>
                        </div>
                      </AccordionDetails>
                    </Accordion>
                  </div>
                </AccordionDetails>
              </Accordion>

              {/* Knowledge Panel */}
              <Accordion defaultExpanded className="shadow-lg border-2 border-gradient-to-r from-blue-100 to-indigo-100 rounded-2xl bg-gradient-to-br from-white to-blue-50">
                <AccordionSummary 
                  expandIcon={<ChevronDown className="w-6 h-6 text-blue-600 transform transition-transform duration-200" />} 
                  className="px-6 py-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-300"
                >
                  <Typography variant="h6" className="flex items-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                    <BookOpen className="mr-3 w-6 h-6 text-blue-500 drop-shadow-sm" />
                    çŸ¥è¯†åº“é…ç½®
                  </Typography>
                </AccordionSummary>
                <AccordionDetails className="px-6 pb-6">
                  <div className="space-y-6">
                    <div>
                      <Typography variant="subtitle1" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                        ä¿¡æ¯å¯¼å…¥
                      </Typography>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div 
                          className="p-4 border-2 border-dashed border-blue-300 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 hover:border-blue-400 hover:bg-gradient-to-r hover:from-blue-100 hover:to-indigo-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'æ–‡æœ¬ä¿¡æ¯å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ“</div>
                          <Typography variant="subtitle2" className="text-blue-700 font-medium">æ–‡æœ¬ä¿¡æ¯</Typography>
                          <Typography variant="body2" className="text-blue-600 text-sm mt-1">å¯¼å…¥æ–‡æ¡£ã€è¯´æ˜ç­‰æ–‡æœ¬å†…å®¹</Typography>
                        </div>
                        
                        <div 
                          className="p-4 border-2 border-dashed border-blue-300 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 hover:border-blue-400 hover:bg-gradient-to-r hover:from-blue-100 hover:to-indigo-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'è¡¨æ ¼æ•°æ®å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ“Š</div>
                          <Typography variant="subtitle2" className="text-blue-700 font-medium">è¡¨æ ¼æ•°æ®</Typography>
                          <Typography variant="body2" className="text-blue-600 text-sm mt-1">å¯¼å…¥Excelã€CSVç­‰è¡¨æ ¼æ•°æ®</Typography>
                        </div>
                        
                        <div 
                          className="p-4 border-2 border-dashed border-blue-300 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 hover:border-blue-400 hover:bg-gradient-to-r hover:from-blue-100 hover:to-indigo-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'å›¾ç‰‡ä¿¡æ¯å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ–¼ï¸</div>
                          <Typography variant="subtitle2" className="text-blue-700 font-medium">å›¾ç‰‡ä¿¡æ¯</Typography>
                          <Typography variant="body2" className="text-blue-600 text-sm mt-1">å¯¼å…¥å›¾ç‰‡ã€å›¾è¡¨ç­‰è§†è§‰ä¿¡æ¯</Typography>
                        </div>
                      </div>
                    </div>

                    <div>
                      <Typography variant="subtitle1" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                        å·²å¯¼å…¥çŸ¥è¯†
                      </Typography>
                      <div className="flex flex-wrap gap-3">
                        {[
                          { id: 'product_manual', name: 'äº§å“æ‰‹å†Œ', description: 'è¯¦ç»†çš„äº§å“ä½¿ç”¨è¯´æ˜å’ŒåŠŸèƒ½ä»‹ç»' },
                          { id: 'faq_database', name: 'å¸¸è§é—®é¢˜', description: 'ç”¨æˆ·å¸¸è§é—®é¢˜è§£ç­”æ•°æ®åº“' },
                          { id: 'company_policies', name: 'å…¬å¸æ”¿ç­–', description: 'ä¼ä¸šè§„ç« åˆ¶åº¦å’Œæ“ä½œæµç¨‹' }
                        ].map((knowledge) => (
                          <Chip
                            key={knowledge.id}
                            label={knowledge.name}
                            onClick={() => {
                              const isSelected = agentConfig.knowledge.includes(knowledge.id)
                              setAgentConfig(prev => ({
                                ...prev,
                                knowledge: isSelected 
                                  ? prev.knowledge.filter(k => k !== knowledge.id)
                                  : [...prev.knowledge, knowledge.id]
                              }))
                            }}
                            color={agentConfig.knowledge.includes(knowledge.id) ? 'primary' : 'default'}
                            variant={agentConfig.knowledge.includes(knowledge.id) ? 'filled' : 'outlined'}
                            className={`text-sm px-4 py-3 cursor-pointer transition-all duration-300 font-medium ${
                              agentConfig.knowledge.includes(knowledge.id)
                                ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg scale-105'
                                : 'bg-white border-2 border-blue-200 text-blue-700 hover:border-blue-400 hover:shadow-md hover:scale-105'
                            }`}
                            title={knowledge.description}
                          />
                        ))}
                      </div>
                    </div>
                  </div>
                </AccordionDetails>
              </Accordion>

              {/* Memory Panel */}
              <Accordion defaultExpanded className="shadow-lg border-2 border-gradient-to-r from-purple-100 to-pink-100 rounded-2xl bg-gradient-to-br from-white to-purple-50">
                <AccordionSummary 
                  expandIcon={<ChevronDown className="w-6 h-6 text-purple-600 transform transition-transform duration-200" />} 
                  className="px-6 py-4 hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 transition-all duration-300"
                >
                  <Typography variant="h6" className="flex items-center text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 font-bold text-lg">
                    <Brain className="mr-3 w-6 h-6 text-purple-500 drop-shadow-sm" />
                    è®°å¿†é…ç½®
                  </Typography>
                </AccordionSummary>
                <AccordionDetails className="px-6 pb-6">
                  <div className="space-y-6">
                    <div>
                      <Typography variant="subtitle1" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 font-bold text-lg">
                        è®°å¿†å­˜å‚¨
                      </Typography>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div 
                          className="p-4 border-2 border-dashed border-purple-300 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50 hover:border-purple-400 hover:bg-gradient-to-r hover:from-purple-100 hover:to-pink-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'å˜é‡å­˜å‚¨åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ”§</div>
                          <Typography variant="subtitle2" className="text-purple-700 font-medium">å˜é‡å­˜å‚¨</Typography>
                          <Typography variant="body2" className="text-purple-600 text-sm mt-1">å­˜å‚¨å’Œæ£€ç´¢å¯¹è¯å˜é‡</Typography>
                        </div>
                        
                        <div 
                          className="p-4 border-2 border-dashed border-purple-300 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50 hover:border-purple-400 hover:bg-gradient-to-r hover:from-purple-100 hover:to-pink-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'æ•°æ®åº“å­˜å‚¨åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ—„ï¸</div>
                          <Typography variant="subtitle2" className="text-purple-700 font-medium">æ•°æ®åº“å­˜å‚¨</Typography>
                          <Typography variant="body2" className="text-purple-600 text-sm mt-1">æŒä¹…åŒ–å­˜å‚¨é‡è¦ä¿¡æ¯</Typography>
                        </div>
                        
                        <div 
                          className="p-4 border-2 border-dashed border-purple-300 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50 hover:border-purple-400 hover:bg-gradient-to-r hover:from-purple-100 hover:to-pink-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'é•¿æœŸè®°å¿†åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ§ </div>
                          <Typography variant="subtitle2" className="text-purple-700 font-medium">é•¿æœŸè®°å¿†</Typography>
                          <Typography variant="body2" className="text-purple-600 text-sm mt-1">è·¨ä¼šè¯çš„è®°å¿†ä¿æŒ</Typography>
                        </div>
                        
                        <div 
                          className="p-4 border-2 border-dashed border-purple-300 rounded-xl bg-gradient-to-r from-purple-50 to-indigo-50 hover:border-purple-400 hover:bg-gradient-to-r hover:from-purple-100 hover:to-indigo-100 transition-all duration-300 cursor-pointer text-center"
                          onClick={() => setSnackbar({ open: true, message: 'æ–‡ä»¶ç›’åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                        >
                          <div className="text-3xl mb-2">ğŸ“</div>
                          <Typography variant="subtitle2" className="text-purple-700 font-medium">æ–‡ä»¶ç›’</Typography>
                          <Typography variant="body2" className="text-purple-600 text-sm mt-1">ç®¡ç†ä¸Šä¼ çš„æ–‡ä»¶å’Œæ–‡æ¡£</Typography>
                        </div>
                      </div>
                    </div>
                  </div>
                </AccordionDetails>
              </Accordion>

              {/* Opening Remarks Panel */}
              <Accordion defaultExpanded className="shadow-lg border-2 border-gradient-to-r from-indigo-100 to-blue-100 rounded-2xl bg-gradient-to-br from-white to-indigo-50">
                <AccordionSummary
                  expandIcon={<ChevronDown className="w-6 h-6 text-indigo-600 transform transition-transform duration-200" />}
                  className="px-6 py-4 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-blue-50 transition-all duration-300"
                >
                  <Typography variant="h6" className="flex items-center text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-600 font-bold text-lg">
                    <MessageSquare className="mr-3 w-6 h-6 text-indigo-500 drop-shadow-sm" />
                    å¼€åœºç™½è®¾ç½®
                  </Typography>
                </AccordionSummary>
                <AccordionDetails className="px-6 pb-6">
                  <div className="space-y-4">
                    <Typography variant="body2" className="text-indigo-600 text-sm">
                      è¿™æ˜¯ç”¨æˆ·å¼€å§‹å¯¹è¯æ—¶æ™ºèƒ½ä½“çš„ç¬¬ä¸€å¥è¯ï¼Œæ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘
                    </Typography>

                    {/* Rich Text Toolbar */}
                    <div className="border-2 border-indigo-200 rounded-lg bg-white p-3">
                      <div className="flex flex-wrap items-center gap-2 mb-3 pb-3 border-b border-indigo-100">
                        {/* Font Controls */}
                        <div className="flex items-center space-x-2">
                          <select
                            className="px-2 py-1 border border-indigo-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            onClick={() => setSnackbar({ open: true, message: 'å­—ä½“é€‰æ‹©åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                          >
                            <option>é»˜è®¤å­—ä½“</option>
                            <option>Arial</option>
                            <option>Times New Roman</option>
                            <option>å¾®è½¯é›…é»‘</option>
                          </select>

                          <select
                            className="px-2 py-1 border border-indigo-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            onClick={() => setSnackbar({ open: true, message: 'å­—å·é€‰æ‹©åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                          >
                            <option>14px</option>
                            <option>12px</option>
                            <option>16px</option>
                            <option>18px</option>
                            <option>20px</option>
                          </select>
                        </div>

                        {/* Text Formatting */}
                        <div className="flex items-center space-x-1">
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'ç²—ä½“åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="ç²—ä½“"
                          >
                            <strong className="text-indigo-700">B</strong>
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'æ–œä½“åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="æ–œä½“"
                          >
                            <em className="text-indigo-700">I</em>
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'ä¸‹åˆ’çº¿åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="ä¸‹åˆ’çº¿"
                          >
                            <u className="text-indigo-700">U</u>
                          </button>
                        </div>

                        {/* Text Alignment */}
                        <div className="flex items-center space-x-1">
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'å·¦å¯¹é½åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="å·¦å¯¹é½"
                          >
                            <div className="w-4 h-4 flex items-center justify-start">
                              <div className="w-3 h-0.5 bg-indigo-700"></div>
                            </div>
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'å±…ä¸­å¯¹é½åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="å±…ä¸­å¯¹é½"
                          >
                            <div className="w-4 h-4 flex items-center justify-center">
                              <div className="w-3 h-0.5 bg-indigo-700"></div>
                            </div>
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'å³å¯¹é½åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="å³å¯¹é½"
                          >
                            <div className="w-4 h-4 flex items-center justify-end">
                              <div className="w-3 h-0.5 bg-indigo-700"></div>
                            </div>
                          </button>
                        </div>

                        {/* Insert Options */}
                        <div className="flex items-center space-x-1">
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'æ’å…¥é“¾æ¥åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="æ’å…¥é“¾æ¥"
                          >
                            ğŸ”—
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'æ’å…¥å›¾ç‰‡åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="æ’å…¥å›¾ç‰‡"
                          >
                            ğŸ–¼ï¸
                          </button>
                          <button
                            className="p-2 hover:bg-indigo-100 rounded transition-colors duration-200"
                            onClick={() => setSnackbar({ open: true, message: 'æ’å…¥è¡¨æƒ…åŠŸèƒ½å¼€å‘ä¸­...', severity: 'info' })}
                            title="æ’å…¥è¡¨æƒ…"
                          >
                            ğŸ˜Š
                          </button>
                        </div>
                      </div>

                      {/* Rich Text Editor */}
                      <div className="relative">
                        <textarea
                          value={agentConfig.openingRemarks}
                          onChange={(e) => setAgentConfig(prev => ({ ...prev, openingRemarks: e.target.value }))}
                          placeholder="è®¾ç½®æ™ºèƒ½ä½“çš„å¼€åœºç™½ï¼Œè®©ç”¨æˆ·äº†è§£å¦‚ä½•å¼€å§‹å¯¹è¯..."
                          className="w-full min-h-[120px] p-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-y"
                          style={{ resize: 'vertical' }}
                        />
                        <div className="absolute bottom-2 right-2 text-xs text-indigo-400">
                          {agentConfig.openingRemarks.length} å­—ç¬¦
                        </div>
                      </div>
                    </div>
                  </div>
                </AccordionDetails>
              </Accordion>
            </div>
          </TabPanel>

          {/* Preview and Debug Tab */}
          <TabPanel value={activeTab} index={2}>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
              {/* Left Panel - Chatbot Dialog */}
              <div className="flex flex-col">
                <Paper elevation={0} className="p-6 border border-gray-200 rounded-xl flex flex-col bg-gradient-to-br from-blue-50 to-indigo-50" style={{ height: '600px' }}>
                  <div className="flex items-center justify-between mb-4">
                    <Typography variant="h6" className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 font-bold text-lg">
                      æ™ºèƒ½ä½“è°ƒè¯•å¯¹è¯
                    </Typography>
                    <div className="flex items-center space-x-2">
                      {agentConfig.debugStats.isRunning && (
                        <>
                          <div className="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                          <span className="text-sm text-gray-600">è¿è¡Œä¸­</span>
                        </>
                      )}
                    </div>
                  </div>
                  
                  {/* Chat Messages Area */}
                  <div className="flex-1 bg-white rounded-xl p-4 mb-4 overflow-y-auto shadow-inner border border-gray-100">
                    {agentConfig.testHistory.length === 0 ? (
                      <div className="text-center py-8">
                        <div className="w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3">
                          <MessageSquare className="w-8 h-8 text-blue-500" />
                        </div>
                        <p className="text-gray-500 text-base font-medium">å¼€å§‹å¯¹è¯ä»¥è°ƒè¯•æ™ºèƒ½ä½“</p>
                        <p className="text-gray-400 text-sm mt-1">è¾“å…¥æ¶ˆæ¯å¼€å§‹æµ‹è¯•æ‚¨çš„æ™ºèƒ½ä½“é…ç½®</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {agentConfig.testHistory.map((msg, index) => (
                          <div
                            key={index}
                            className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                          >
                            <div className={`max-w-[85%] ${msg.role === 'user' ? 'order-2' : 'order-1'}`}>
                              {msg.role === 'assistant' && (
                                <div className="flex items-center space-x-2 mb-2">
                                  <div className="w-6 h-6 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center">
                                    <span className="text-white text-xs font-bold">AI</span>
                                  </div>
                                  <span className="text-sm text-gray-600 font-medium">æ—…è¡Œè§„åˆ’åŠ©æ‰‹</span>
                                  <span className="text-xs text-gray-400">
                                    {msg.timestamp.toLocaleTimeString()}
                                  </span>
                                </div>
                              )}
                              
                              <div
                                className={`p-3 rounded-xl shadow-sm ${
                                  msg.role === 'user' 
                                    ? 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white' 
                                    : 'bg-white border border-gray-200 text-gray-800'
                                }`}
                              >
                                <div className="text-sm leading-relaxed whitespace-pre-wrap">{msg.content}</div>
                              </div>
                              
                              {msg.role === 'user' && (
                                <div className="flex items-center justify-end space-x-2 mt-2">
                                  <span className="text-xs text-gray-400">
                                    {msg.timestamp.toLocaleTimeString()}
                                  </span>
                                  <div className="w-5 h-5 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center">
                                    <span className="text-white text-xs font-bold">æˆ‘</span>
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                  
                  {/* Input Area */}
                  <div className="bg-white rounded-xl p-3 border border-gray-200 shadow-sm">
                    <div className="flex items-center space-x-3">
                      <TextField
                        fullWidth
                        value={testMessage}
                        onChange={(e) => setTestMessage(e.target.value)}
                        placeholder="è¾“å…¥æ¶ˆæ¯æ¥æµ‹è¯•æ™ºèƒ½ä½“..."
                        onKeyPress={(e) => e.key === 'Enter' && handleTest()}
                        size="small"
                        className="flex-1"
                        sx={{
                          '& .MuiOutlinedInput-root': {
                            borderRadius: '12px',
                            '&:hover fieldset': {
                              borderColor: '#3B82F6',
                            },
                          },
                        }}
                      />
                      <Button
                        variant="contained"
                        startIcon={<Play className="w-4 h-4" />}
                        onClick={handleTest}
                        disabled={isTesting || !testMessage.trim()}
                        className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-lg px-4 rounded-xl"
                        size="small"
                        sx={{
                          borderRadius: '12px',
                          textTransform: 'none',
                          fontWeight: 600,
                        }}
                      >
                        {isTesting ? (
                          <div className="flex items-center space-x-2">
                            <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                            <span>å‘é€ä¸­...</span>
                          </div>
                        ) : (
                          'å‘é€'
                        )}
                      </Button>
                    </div>
                  </div>
                </Paper>
              </div>

              {/* Right Panel - Debug Information Tree */}
              <div className="flex flex-col">
                <Paper elevation={0} className="p-6 border border-gray-200 rounded-xl flex flex-col bg-gradient-to-br from-green-50 to-emerald-50" style={{ height: '600px' }}>
                  <Typography variant="h6" className="mb-4 text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600 font-bold text-lg">
                    è°ƒè¯•ä¿¡æ¯
                  </Typography>
                  
                  <div className="flex-1 bg-white rounded-xl p-4 overflow-y-auto shadow-inner border border-gray-100">
                    <div className="space-y-4">
                      {/* Real-time Running Status */}
                      <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 p-4">
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center space-x-2">
                            <div className={`w-3 h-3 rounded-full ${agentConfig.debugStats.isRunning ? 'bg-green-500 animate-pulse' : 'bg-gray-400'}`}></div>
                            <span className="font-semibold text-gray-800">å®æ—¶è¿è¡ŒçŠ¶æ€</span>
                          </div>
                          <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                            agentConfig.debugStats.isRunning 
                              ? 'bg-green-100 text-green-700' 
                              : 'bg-gray-100 text-gray-600'
                          }`}>
                            {agentConfig.debugStats.isRunning ? 'è¿è¡Œä¸­' : ''}
                          </span>
                        </div>
                        <div className="grid grid-cols-2 gap-3 text-sm">
                          <div className="flex justify-between">
                            <span className="text-gray-600">å“åº”æ—¶é—´:</span>
                            <span className="font-medium text-blue-600">{agentConfig.debugStats.responseTime}s</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">æ´»è·ƒæ’ä»¶:</span>
                            <span className="font-medium text-green-600">{agentConfig.debugStats.activePlugins}</span>
                          </div>
                        </div>
                      </div>

                      {/* Token Consumption */}
                      <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 p-4">
                        <div className="flex items-center space-x-2 mb-3">
                          <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
                          <span className="font-semibold text-gray-800">Token æ¶ˆè€—</span>
                        </div>
                        <div className="space-y-3">
                          <div className="flex justify-between items-center">
                            <span className="text-gray-600 text-sm">å·²ä½¿ç”¨:</span>
                            <span className="font-bold text-purple-600 text-lg">{agentConfig.debugStats.tokensUsed.toLocaleString()}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                              className="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300"
                              style={{ width: `${Math.min((agentConfig.debugStats.tokensUsed / 4000) * 100, 100)}%` }}
                            ></div>
                          </div>
                          <div className="flex justify-between text-xs text-gray-500">
                            <span>0</span>
                            <span>4,000</span>
                          </div>
                        </div>
                      </div>

                      {/* Memory Usage */}
                      <div className="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl border border-orange-200 p-4">
                        <div className="flex items-center space-x-2 mb-3">
                          <div className="w-3 h-3 bg-orange-500 rounded-full"></div>
                          <span className="font-semibold text-gray-800">å†…å­˜ä½¿ç”¨</span>
                        </div>
                        <div className="space-y-3">
                          <div className="flex justify-between items-center">
                            <span className="text-gray-600 text-sm">ä½¿ç”¨ç‡:</span>
                            <span className="font-bold text-orange-600 text-lg">{agentConfig.debugStats.memoryUsage}%</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                              className="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300"
                              style={{ width: `${agentConfig.debugStats.memoryUsage}%` }}
                            ></div>
                          </div>
                          <div className="flex justify-between text-xs text-gray-500">
                            <span>0%</span>
                            <span>100%</span>
                          </div>
                        </div>
                      </div>

                      {/* Conversation Stats Tree */}
                      <div className="bg-white rounded-lg border border-gray-200 p-3">
                        <div className="flex items-center space-x-2 mb-2">
                          <ChevronDown className="w-4 h-4 text-gray-600" />
                          <span className="font-semibold text-gray-800">å¯¹è¯ç»Ÿè®¡</span>
                        </div>
                        <div className="ml-6 space-y-2 text-sm">
                          <div className="flex justify-between">
                            <span className="text-gray-600">æ€»å¯¹è¯æ•°:</span>
                            <span className="font-medium">{Math.floor(agentConfig.testHistory.length / 2)}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">ç”¨æˆ·æ¶ˆæ¯:</span>
                            <span className="font-medium">{agentConfig.testHistory.filter(msg => msg.role === 'user').length}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">æ™ºèƒ½ä½“å›å¤:</span>
                            <span className="font-medium">{agentConfig.testHistory.filter(msg => msg.role === 'assistant').length}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </Paper>
              </div>
            </div>
          </TabPanel>
        </Card>
      </div>

      <Snackbar
        open={snackbar.open}
        autoHideDuration={6000}
        onClose={() => setSnackbar({ ...snackbar, open: false })}
      >
        <Alert 
          onClose={() => setSnackbar({ ...snackbar, open: false })} 
          severity={snackbar.severity}
        >
          {snackbar.message}
        </Alert>
      </Snackbar>
    </div>
  )
}

export default AgentEditorEnhancedPage